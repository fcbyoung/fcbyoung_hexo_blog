---
title: 对比RIP，IS-IS，OSPF，BGP四大路由协议（1）宣告路由
date: 2025-10-21 23:50:21
tags: [网络工程师,计算机网络]
---

### 一、RIP路由协议

RIP是一种基于距离矢量的内部网关协议，它通过UDP 520端口进行路由信息交换。在华为设备上，其宣告方式相对直接。

#### 1. 宣告命令

在华为设备上，你需要在RIP进程视图下使用 `network` 命令来宣告直连网络。**关键点在于：`network` 后面跟的是主类网络号（即A、B、C类网络），RIP会自动将该主类网络下的所有直连接口启用RIP。**

**基本配置步骤：**

```bash
<Huawei> system-view
[Huawei] rip [process-id]          # 启动RIP进程，进程ID默认为1
[Huawei-rip-1] version 2           # 强烈建议使用RIPv2，支持VLSM和认证
[Huawei-rip-1] network 192.168.1.0 # 宣告主类网络。例如，如果接口IP是192.168.1.1/24，则宣告192.168.1.0
[Huawei-rip-1] network 10.0.0.0    # 宣告另一个主类网络，例如A类网络10.0.0.0
```

**示例：**
假设路由器有一个接口G0/0/0，IP地址为 `192.168.1.1/24`，另一个接口G0/0/1，IP地址为 `10.1.1.1/24`。配置如下：
```bash
[Huawei] rip 1
[Huawei-rip-1] version 2
[Huawei-rip-1] network 192.168.1.0
[Huawei-rip-1] network 10.0.0.0
# 注意：即使接口地址是10.1.1.1，也只需宣告其主类网络号 10.0.0.0
```

#### 2. 注意事项

1. **宣告主类网络**：这是最核心也最容易出错的地方。`network` 命令后跟的是**有类网络地址**，而不是子网或接口IP。RIP进程会检查所有直连接口的IP地址，只要落在该主类网络范围内，该接口就会：
   - 开始发送和接收RIP更新。
   - 将该接口的IP网络地址宣告给邻居。

2. **RIP版本**：
   - **RIPv1**：广播更新、不支持VLSM、不支持认证。**基本已淘汰**。
   - **RIPv2**：组播更新（224.0.0.9）、**支持VLSM和CIDR**、支持明文/MD5认证。**当前标准配置**。
   - 在与其他厂商设备互操作时，可能需要使用 `undo summary` 命令关闭自动汇总。

3. **自动汇总**：RIPv2默认开启**自动汇总**（在边界路由器上会将子网路由汇总为主类网络宣告出去）。在不连续子网环境中，这会导致路由问题，需要使用 `undo summary` 命令关闭。

   好的，您的理解非常准确。与RIP、OSPF需要明确宣告网络范围不同，IS-IS的“宣告”方式确实非常独特，它**不直接宣告IP网段**，而是**宣告路由器本身**。

   ---

   ### 二、IS-IS路由协议

   IS-IS是一个链路状态协议，最初为OSI（开放式系统互联）网络设计，后来被扩展以支持IP。它的核心思想是：每台路由器在链路状态协议数据单元中通告自己的链路状态信息，而不是直接宣告IP网络。

   #### 1. “宣告”方式：启用IS-IS并分配NET地址

   在IS-IS中，所谓的“宣告”包含两个关键步骤：

   1.  **在路由器上全局启用IS-IS进程，并为其分配一个网络实体名称。**
   2.  **在特定接口上启用IS-IS协议，使该接口参与IS-IS路由计算和邻接关系建立。**

   **基本配置步骤：**

   ```bash
   <Huawei> system-view
   [Huawei] isis [process-id]                  # 启动IS-IS进程，进程ID默认为1
   [Huawei-isis-1] network-entity 49.0001.0010.0100.1001.00 # 配置NET地址，这是路由器的唯一标识
   [Huawei-isis-1] quit
   [Huawei] interface gigabitethernet 0/0/0    # 进入需要运行IS-IS的接口
   [Huawei-GigabitEthernet0/0/0] isis enable [process-id] # 在该接口上启用IS-IS
   ```

   **示例：**
   假设我们要在接口G0/0/0和G0/0/1上运行IS-IS。
   ```bash
   [Huawei] isis 1
   [Huawei-isis-1] network-entity 49.0001.0000.0000.0001.00
   [Huawei-isis-1] quit
   [Huawei] interface gigabitethernet 0/0/0
   [Huawei-GigabitEthernet0/0/0] isis enable 1
   [Huawei-GigabitEthernet0/0/0] quit
   [Huawei] interface gigabitethernet 0/0/1
   [Huawei-GigabitEthernet0/0/1] isis enable 1
   ```

   #### 2. 核心机制与注意事项

   1.  **NET地址**：
       *   这是IS-IS中**最重要**的标识符，相当于OSPF中的Router-ID加上区域ID的结合体。
       *   **格式**：`AA.AAAA.BBBB.BBBB.BBBB.CC`
           *   `AA.AAAA`：区域地址（Area ID）。
           *   `BBBB.BBBB.BBBB`：系统ID（System ID），在一个域内必须唯一。通常由Loopback接口的MAC地址或IP地址转换而来。
           *   `CC`：SEL，对于IP路由而言，总是`00`。
       *   路由器通过NET地址来识别彼此和计算SPF树。

   2.  **接口启用**：
       *   在接口视图下使用 `isis enable` 命令后，该接口就会：
           *   发送和接收IS-IS Hello报文，与同一链路上的邻居建立邻接关系。
           *   将该接口的**IP地址和掩码**作为**TLV**信息放入其LSP中，并泛洪给其他邻居。
       *   **间接宣告**：路由器A在接口G0/0/0上配置了IP地址 `192.168.1.1/24` 并启用了IS-IS。那么，A会在自己生成的LSP中携带信息：“我连接到了一个IP网络 `192.168.1.0/24`”。其他路由器收到这个LSP后，就能学习到这条路由。

   3.  **层级与网络类型**：
       *   **层级**：IS-IS有两级层级。
           *   `is-level`： 可以配置为 `level-1`（类似OSPF的完全末节区域）、`level-2`（骨干路由器）或 `level-1-2`（默认，边界路由器）。
       *   **网络类型**： 类似于OSPF，需要在接口下指定网络类型，如 `isis circuit-type p2p` 用于点对点链路，这对于正确建立邻接至关重要。

   4.  **与RIP/OSPF的对比总结**：
       *   **RIP/OSPF**：`network <IP网络>` -> **宣告一个网络范围**，落在该范围内的接口被激活。
       *   **IS-IS**：`network-entity <NET>` + `interface下 isis enable` -> **宣告路由器本身**，并明确指定哪些接口参与通信。

   **简单来说，IS-IS的“宣告”逻辑是：** “大家好，我是路由器 `[NET]`，我连接到了以下这些IP网络...”，而这些网络信息是通过在接口上启用IS-IS来自动收集和分发的。

---

### 三、OSPF路由协议

OSPF是一种基于链路状态的内部网关协议。它的核心思想是：每台路由器通过泛洪LSA来描述自己周围的网络拓扑，所有路由器共同维护一个相同的链路状态数据库，然后各自独立地使用SPF算法计算出无环的最短路径树。

#### 1. 宣告方式：在区域中宣告精确的网络范围

与RIP宣告主类网络不同，OSPF使用 `network` 命令来**精确地匹配接口**，并将匹配成功的接口放入指定的OSPF区域中。宣告的本质是：“让这个接口参与OSPF路由进程，并将其连接的网段信息以LSA的形式发布出去。”

**基本配置步骤：**

```bash
<Huawei> system-view
[Huawei] ospf [process-id] router-id router-id  # 启动OSPF进程并配置Router-ID
[Huawei-ospf-1] area area-id                    # 进入区域视图（通常是区域0）
[Huawei-ospf-1-area-0.0.0.0] network ip-address wildcard-mask  # 宣告网络（反掩码方式）
```

**示例：**
假设路由器有一个接口G0/0/0，IP地址为 `192.168.1.1/24`，另一个接口G0/0/1，IP地址为 `10.1.1.1/24`。我们希望G0/0/0在区域0，G0/0/1在区域1。

```bash
[Huawei] ospf 1 router-id 1.1.1.1
[Huawei-ospf-1] area 0
[Huawei-ospf-1-area-0.0.0.0] network 192.168.1.0 0.0.0.255
[Huawei-ospf-1] area 1
[Huawei-ospf-1-area-0.0.0.1] network 10.1.1.0 0.0.0.255
```

**关键点：反掩码**
- 反掩码也叫通配符掩码，与子网掩码相反。
- **0** 表示需要精确匹配的位。
- **1** 表示忽略的位。
- 所以，对于 `192.168.1.0/24` 网段，其反掩码是 `0.0.0.255`。这条命令的意思是：将所有IP地址前24位（即192.168.1）匹配的接口激活OSPF，并放入相应区域。

**更现代的宣告方式：在接口下直接启用OSPF**
华为设备也支持一种更直观、更精确的配置方式，推荐使用：

```bash
[Huawei] ospf 1 router-id 1.1.1.1
[Huawei-ospf-1] area 0
[Huawei-ospf-1-area-0.0.0.0] quit
[Huawei-ospf-1] quit
[Huawei] interface gigabitethernet 0/0/0
[Huawei-GigabitEthernet0/0/0] ospf enable 1 area 0  # 在该接口上直接启用OSPF并指定区域
```
这种方式避免了反掩码的计算，更加清晰，不易出错。

#### 2. 核心机制与注意事项

1.  **Router-ID**：
    *   这是OSPF中路由器的唯一标识，格式类似于IP地址（如 `1.1.1.1`）。
    *   **必须唯一**，否则会导致路由计算混乱。通常手动配置为Loopback接口的IP地址，以确保稳定性。
    *   选择顺序：手动配置 > 最大Loopback接口IP > 最大物理接口IP。

2.  **区域概念**：
    *   OSPF通过**区域**来实现层次化设计和规模扩展。**Area 0是骨干区域，是必需的**，所有非骨干区域必须直接与Area 0相连。
    *   宣告时必须指定接口所在的区域，这是RIP所没有的概念。

3.  **网络类型**：
    *   OSPF接口有不同的网络类型（如Broadcast、P2P、NBMA、P2MP），这会直接影响邻居发现和DR/BDR的选举。需要根据实际链路类型进行正确配置。

4.  **引入外部路由**：与RIP类似，使用 `import-route` 命令。
    
    ```bash
    [Huawei-ospf-1] import-route static  # 引入静态路由，默认为Type-2外部路由
    [Huawei-ospf-1] import-route rip 1    # 引入RIP路由
    ```

**总结比喻：**

- **RIP** 像一个**传令兵**，每隔一段时间就跑到邻居那里告诉他：“我听说去往某某地方要经过X跳”。信息是二手、三手的，且相对模糊（只宣告主类网络）。
- **OSPF** 像一个**测绘团队**，每台路由器都会绘制自己周围的精确地图（LSA），然后大家互相交换地图碎片，最终每台路由器都拼出一张完整的网络地图（LSDB），并自己计算去往所有目的地的最短路径。宣告的接口就是地图上的精确坐标。

---

好的，我们来讲解BGP，并最后对RIP、OSPF和BGP的宣告方式进行对比总结。

---

### 四、BGP路由协议

BGP是一种路径矢量协议，也是事实上的互联网外部网关协议标准。与IGP（内部网关协议，如RIP、OSPF）不同，BGP的核心设计目标是**在不同自治系统之间提供可控的、策略驱动的路由交换**，而不是简单地寻找最短路径。

#### 1. 宣告方式：手动、精确地发布网络

BGP的宣告哲学与IGP完全不同。它**不会自动宣告任何路由**。你必须明确地告诉BGP进程："请将这条路由发布给我的BGP邻居"。这种设计赋予了网络管理员极大的控制权。

**BGP路由注入的两种主要方式：**

1.  **`network` 命令**
2.  **重分发**

**基本配置步骤：**

```bash
<Huawei> system-view
[Huawei] bgp as-number                    # 启动BGP进程，指定本地AS号
[Huawei-bgp] router-id router-id          # 配置Router-ID（必须唯一）
[Huawei-bgp] peer ip-address as-number as-number # 配置BGP邻居（对等体）
[Huawei-bgp] ipv4-family unicast          # 进入IPv4单播地址族视图
[Huawei-bgp-af-ipv4] network ip-address mask mask # 精确宣告网络（必须带掩码）
```

**示例：**
假设公司AS号为65001，需要向BGP邻居（IP为2.2.2.2，AS号为65002）宣告网络 `192.168.1.0/24` 和 `10.1.0.0/16`。

```bash
[Huawei] bgp 65001
[Huawei-bgp] router-id 1.1.1.1
[Huawei-bgp] peer 2.2.2.2 as-number 65002
[Huawei-bgp] ipv4-family unicast
[Huawei-bgp-af-ipv4] network 192.168.1.0 mask 255.255.255.0
[Huawei-bgp-af-ipv4] network 10.1.0.0 mask 255.255.0.0
```

#### 2. 核心机制与注意事项

1.  **`network` 命令的条件**：
    *   这是BGP中最重要也最容易混淆的一点。使用 `network` 命令宣告一条路由时，**该路由必须已经存在于本地的IP路由表中**（可以是直连路由、静态路由或IGP学习到的路由）。
    *   BGP的 `network` 命令是 **"发布"** 命令，而非OSPF/RIP的 **"激活"** 命令。它不激活任何接口，只是将IP路由表中已有的路由复制到BGP表中，然后发送给邻居。

2.  **重分发**：
    *   另一种常见方式是将IGP路由或静态路由重分发到BGP中。
    *   **命令**：`[Huawei-bgp-af-ipv4] import-route ospf 1` 或 `import-route static`
    *   **注意**：重分发需要非常小心，因为它可能意外地将内部路由泄露到互联网上。通常建议使用精确的 `network` 命令来控制要宣告的路由。

3.  **邻居关系**：
    *   BGP邻居（对等体）必须**手动指定**，这与IGP的自动发现邻居截然不同。
    *   邻居可以是不同AS的（EBGP），也可以是同一AS内的（IBGP）。两者行为有显著差异（如EBGP默认跳数、IBGP的水平分割规则）。

4.  **策略驱动**：
    *   BGP的强大之处在于其丰富的路径属性（如AS_PATH、NEXT_HOP、LOCAL_PREF、MED等）。
    *   宣告路由时，通常会配合路由策略来修改这些属性，以影响入站和出站的流量路径。例如，使用 `filter-policy` 或 `route-policy` 来过滤或设置属性。

---

### RIP、OSPF、BGP宣告方式对比总结

| 特性         | RIP                              | OSPF                                                        | BGP                                  |
| :----------- | :------------------------------- | :---------------------------------------------------------- | :----------------------------------- |
| **协议类型** | 距离矢量IGP                      | 链路状态IGP                                                 | 路径矢量EGP                          |
| **宣告哲学** | **激活接口**以宣告其所在主类网络 | **激活接口**到特定区域以宣告其精确网络                      | **发布**IP路由表中已存在的特定路由   |
| **宣告命令** | `network 10.0.0.0`               | `network 10.1.1.0 0.0.0.255 area 0` 或 `接口下 ospf enable` | `network 10.1.0.0 mask 255.255.0.0`  |
| **关键参数** | 主类网络号                       | **区域ID**、网络地址+**反掩码**                             | **AS号**、网络地址+**掩码**          |
| **自动性**   | 自动宣告匹配接口的**主类网络**   | 自动宣告匹配接口的**精确网络**                              | **完全不自动**，必须手动发布每条路由 |
| **控制粒度** | 粗（按主类网络）                 | 细（按接口/精确网络）                                       | **最精细**（按任意前缀/掩码）        |
| **邻居建立** | 自动（广播/组播）                | 自动（组播）                                                | **手动**指定每个邻居                 |
| **设计目标** | 简单互通，找"跳数少"的路径       | 快速收敛，找"成本低"的最优路径                              | **策略控制**，找"符合策略"的路径     |

**总结比喻：**

- **RIP** 像一个**社区广播**："我们小区（主类网络）的人可以互相串门了！" 信息比较模糊。
- **OSPF** 像一个**城市规划局**，将城市划分为不同的**区域**，并精确绘制每条街道（接口网络）的地图，让大家都能找到最优路径。
- **BGP** 像一个**国家间的外交官**，他不会自动透露任何信息。只有当本国政府（IP路由表）明确授权，并且他手动准备好外交照会（`network`命令）后，他才会**有选择地、附带各种条件地**将特定信息（路由）告知给**手动指定**的外国大使（BGP邻居）。

